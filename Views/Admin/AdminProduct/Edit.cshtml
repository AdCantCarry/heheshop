@model heheshop.Models.Product
@{
    ViewData["Title"] = "Sửa sản phẩm";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<!-- AOS CSS -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h2 class="text-white mb-4 text-center" data-aos="fade-down">✏️ Sửa sản phẩm: @Model.Name</h2>
            
            <div class="card-glass" data-aos="fade-up" data-aos-delay="200">
                <div class="card-body">
                    <form asp-action="Edit" method="post" enctype="multipart/form-data">
                        <input asp-for="Id" type="hidden" />
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger-custom"></div>

                        <div class="row">
                            <div class="col-md-12 mb-4" data-aos="fade-up" data-aos-delay="300">
                                <label asp-for="Name" class="form-label-custom">
                                    <i class="fas fa-tag"></i> Tên sản phẩm <span class="text-danger">*</span>
                                </label>
                                <input asp-for="Name" class="form-control-custom" placeholder="Nhập tên sản phẩm" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4" data-aos="fade-up" data-aos-delay="400">
                                <label asp-for="Description" class="form-label-custom">
                                    <i class="fas fa-align-left"></i> Mô tả sản phẩm
                                </label>
                                <textarea asp-for="Description" class="form-control-custom" rows="4" 
                                          placeholder="Nhập mô tả chi tiết về sản phẩm"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4" data-aos="fade-up" data-aos-delay="500">
                                <label asp-for="Price" class="form-label-custom">
                                    <i class="fas fa-dollar-sign"></i> Giá bán <span class="text-danger">*</span>
                                </label>
                                <div class="input-group-custom">
                                    <input asp-for="Price" class="form-control-custom" type="number" step="1000" min="0" 
                                           placeholder="0" />
                                    <span class="input-group-text-custom">VNĐ</span>
                                </div>
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-4" data-aos="fade-up" data-aos-delay="600">
                                <label asp-for="Stock" class="form-label-custom">
                                    <i class="fas fa-boxes"></i> Số lượng tồn kho <span class="text-danger">*</span>
                                </label>
                                <input asp-for="Stock" class="form-control-custom" type="number" min="0" 
                                       placeholder="0" />
                                <span asp-validation-for="Stock" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4" data-aos="fade-up" data-aos-delay="700">
                                <label asp-for="BrandId" class="form-label-custom">
                                    <i class="fas fa-trademark"></i> Thương hiệu <span class="text-danger">*</span>
                                </label>
                                <select asp-for="BrandId" class="form-select-custom" asp-items="ViewBag.Brands">
                                    <option value="">-- Chọn thương hiệu --</option>
                                </select>
                                <span asp-validation-for="BrandId" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-4" data-aos="fade-up" data-aos-delay="800">
                                <label asp-for="CategoryId" class="form-label-custom">
                                    <i class="fas fa-list"></i> Danh mục <span class="text-danger">*</span>
                                </label>
                                <select asp-for="CategoryId" class="form-select-custom" asp-items="ViewBag.Categories">
                                    <option value="">-- Chọn danh mục --</option>
                                </select>
                                <span asp-validation-for="CategoryId" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-4" data-aos="fade-up" data-aos-delay="900">
                                <label class="form-label-custom">
                                    <i class="fas fa-image"></i> Ảnh đại diện sản phẩm
                                </label>
                                
                                @if (!string.IsNullOrEmpty(Model.ThumbnailUrl))
                                {
                                    <div class="current-image-wrapper mb-3">
                                        <div class="current-image-label">Ảnh hiện tại:</div>
                                        <img src="@Model.ThumbnailUrl" alt="Current image" class="current-image">
                                    </div>
                                }
                                
                                <div class="file-upload-wrapper">
                                    <input type="file" name="thumbnail" class="form-control-file-custom" accept="image/*" id="thumbnailInput" />
                                    <label for="thumbnailInput" class="file-upload-label">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span>Chọn ảnh mới hoặc kéo thả vào đây</span>
                                    </label>
                                    <div class="file-upload-preview" id="imagePreview"></div>
                                </div>
                                <div class="form-text-custom">
                                    Chọn file ảnh mới (JPG, PNG, GIF) để thay thế. Để trống nếu không muốn đổi ảnh.
                                </div>
                                
                                <!-- Hidden field để giữ URL ảnh cũ -->
                                <input asp-for="ThumbnailUrl" type="hidden" />
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12" data-aos="fade-up" data-aos-delay="1000">
                                <hr class="divider-custom">
                                <div class="d-flex justify-content-between">
                                    <a asp-action="Index" class="btn btn-secondary-custom">
                                        <i class="fas fa-arrow-left"></i> Quay lại
                                    </a>
                                    <button type="submit" class="btn btn-primary-custom">
                                        <i class="fas fa-save"></i> Cập nhật sản phẩm
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card-glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 1rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-body {
        padding: 2rem;
    }

    .form-label-custom {
        color: #ffffff;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: block;
    }

    .form-label-custom i {
        margin-right: 0.5rem;
        color: #a3bffa;
    }

    .form-control-custom, .form-select-custom {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 0.5rem;
        color: #ffffff;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(12px);
    }

    .form-control-custom:focus, .form-select-custom:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        color: #ffffff;
    }

    .form-control-custom::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    .form-select-custom option {
        background: #2d3748;
        color: #ffffff;
    }

    .input-group-custom {
        display: flex;
        align-items: center;
    }

    .input-group-text-custom {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-left: none;
        color: #ffffff;
        padding: 0.75rem 1rem;
        border-radius: 0 0.5rem 0.5rem 0;
        backdrop-filter: blur(12px);
    }

    .input-group-custom .form-control-custom {
        border-radius: 0.5rem 0 0 0.5rem;
        border-right: none;
    }

    .current-image-wrapper {
        text-align: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .current-image-label {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }

    .current-image {
        max-width: 200px;
        max-height: 200px;
        border-radius: 0.5rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
        object-fit: cover;
    }

    .file-upload-wrapper {
        position: relative;
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.05);
    }

    .file-upload-wrapper:hover {
        border-color: #007bff;
        background: rgba(0, 123, 255, 0.1);
    }

    .form-control-file-custom {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }

    .file-upload-label {
        color: rgba(255, 255, 255, 0.8);
        cursor: pointer;
        margin: 0;
    }

    .file-upload-label i {
        font-size: 2rem;
        display: block;
        margin-bottom: 0.5rem;
        color: #a3bffa;
    }

    .file-upload-preview {
        margin-top: 1rem;
    }

    .file-upload-preview img {
        max-width: 200px;
        max-height: 200px;
        border-radius: 0.5rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .form-text-custom {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    .divider-custom {
        border: none;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        margin: 2rem 0;
    }

    .btn-primary-custom {
        background: linear-gradient(45deg, #007bff, #6610f2);
        border: none;
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary-custom:hover {
        background: linear-gradient(45deg, #0056b3, #520dc2);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
        color: white;
    }

    .btn-secondary-custom {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        backdrop-filter: blur(12px);
    }

    .btn-secondary-custom:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        color: white;
    }

    .alert-danger-custom {
        background: rgba(220, 53, 69, 0.2);
        border: 1px solid rgba(220, 53, 69, 0.3);
        color: #ffffff;
        border-radius: 1rem;
        backdrop-filter: blur(12px);
    }

    media (max-width: 768px) {
        .card-body {
            padding: 1.5rem;
        }
        
        .d-flex.justify-content-between {
            flex-direction: column;
            gap: 1rem;
        }
        
        .btn-primary-custom, .btn-secondary-custom {
            width: 100%;
        }
        
        .current-image {
            max-width: 150px;
            max-height: 150px;
        }
    }
</style>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Preview ảnh mới khi chọn file
        document.getElementById('thumbnailInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('imagePreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <div style="margin-top: 1rem;">
                            <div style="color: rgba(255, 255, 255, 0.8); font-size: 0.875rem; margin-bottom: 0.5rem;">
                                Ảnh mới được chọn:
                            </div>
                            <img src="${e.target.result}" alt="New Preview" style="max-width: 200px; max-height: 200px; border-radius: 0.5rem; border: 2px solid rgba(255, 255, 255, 0.2);">
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
            }
        });
    </script>
}

<!-- AOS Scripts -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init({
        duration: 1000,
        once: true,
        offset: 100
    });
</script>